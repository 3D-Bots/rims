import { User } from '../types/User';
import { Item } from '../types/Item';
import { initializeDatabase, isDatabaseInitialized } from '../services/db/db';
import { hasExistingLocalStorageData, migrateFromLocalStorage, verifyMigration } from '../services/db/migration';
import { userRepository, itemRepository } from '../services/db/repositories';

const seedUsers: Omit<User, 'id'>[] = [
  {
    email: 'admin@example.com',
    password: 'changeme',
    role: 'admin',
    signInCount: 0,
    lastSignInAt: null,
    lastSignInIp: null,
    emailVerified: true,
    emailVerificationToken: null,
    emailVerificationTokenExpiresAt: null,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    email: 'user@example.com',
    password: 'changeme',
    role: 'user',
    signInCount: 0,
    lastSignInAt: null,
    lastSignInIp: null,
    emailVerified: true,
    emailVerificationToken: null,
    emailVerificationTokenExpiresAt: null,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
];

const seedItems: Omit<Item, 'id'>[] = [
  // Arduino
  {
    name: 'Arduino Uno',
    description: 'The Arduino Uno is a microcontroller board based on the ATmega328.',
    productModelNumber: 'R3',
    vendorPartNumber: '50',
    vendorName: 'Adafruit',
    quantity: 8,
    unitValue: 24.95,
    value: 199.60,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/50',
    category: 'Arduino',
    location: 'H1LD1B1',
    barcode: 'RIMS-0001',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Arduino Mega 2560',
    description: 'The Arduino Mega 2560 is a microcontroller board based on the ATmega2560.',
    productModelNumber: 'R3',
    vendorPartNumber: '191',
    vendorName: 'Adafruit',
    quantity: 1,
    unitValue: 45.95,
    value: 45.95,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/191',
    category: 'Arduino',
    location: 'H1LD1B3',
    barcode: 'RIMS-0002',
    reorderPoint: 2,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Arduino Nano',
    description: 'Compact Arduino board with ATmega328P, ideal for breadboard projects.',
    productModelNumber: 'V3',
    vendorPartNumber: '1501',
    vendorName: 'SparkFun',
    quantity: 15,
    unitValue: 22.95,
    value: 344.25,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/1501',
    category: 'Arduino',
    location: 'H1LD1B2',
    barcode: 'RIMS-0003',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Raspberry Pi
  {
    name: 'Raspberry Pi 4 Model B',
    description: 'Quad-core 64-bit ARM Cortex-A72 running at 1.5GHz with 4GB RAM.',
    productModelNumber: '4B-4GB',
    vendorPartNumber: '4292',
    vendorName: 'Adafruit',
    quantity: 5,
    unitValue: 55.00,
    value: 275.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/4292',
    category: 'Raspberry Pi',
    location: 'H1LD2B1',
    barcode: 'RIMS-0004',
    reorderPoint: 3,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Raspberry Pi Zero 2 W',
    description: 'Compact single-board computer with wireless connectivity.',
    productModelNumber: 'Zero2W',
    vendorPartNumber: '5291',
    vendorName: 'Adafruit',
    quantity: 10,
    unitValue: 15.00,
    value: 150.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/5291',
    category: 'Raspberry Pi',
    location: 'H1LD2B2',
    barcode: 'RIMS-0005',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Sensors
  {
    name: 'DHT22 Temperature & Humidity Sensor',
    description: 'Digital temperature and humidity sensor with single-wire interface.',
    productModelNumber: 'DHT22',
    vendorPartNumber: '385',
    vendorName: 'Adafruit',
    quantity: 25,
    unitValue: 9.95,
    value: 248.75,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/385',
    category: 'Sensors',
    location: 'H2LD1B1',
    barcode: 'RIMS-0006',
    reorderPoint: 10,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'HC-SR04 Ultrasonic Distance Sensor',
    description: 'Ultrasonic ranging module with 2cm to 400cm range.',
    productModelNumber: 'HC-SR04',
    vendorPartNumber: '3942',
    vendorName: 'Adafruit',
    quantity: 20,
    unitValue: 3.95,
    value: 79.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/3942',
    category: 'Sensors',
    location: 'H2LD1B2',
    barcode: 'RIMS-0007',
    reorderPoint: 10,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'MPU-6050 Accelerometer & Gyroscope',
    description: '6-axis motion tracking device with I2C interface.',
    productModelNumber: 'MPU-6050',
    vendorPartNumber: 'SEN-11028',
    vendorName: 'SparkFun',
    quantity: 12,
    unitValue: 14.95,
    value: 179.40,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/11028',
    category: 'Sensors',
    location: 'H2LD1B3',
    barcode: 'RIMS-0008',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // LCDs & Displays
  {
    name: '16x2 LCD Display with I2C',
    description: 'Blue backlight 16x2 character LCD with I2C interface module.',
    productModelNumber: 'LCD1602-I2C',
    vendorPartNumber: '181',
    vendorName: 'Adafruit',
    quantity: 18,
    unitValue: 12.95,
    value: 233.10,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/181',
    category: 'LCDs & Displays',
    location: 'H2LD2B1',
    barcode: 'RIMS-0009',
    reorderPoint: 8,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: '0.96" OLED Display 128x64',
    description: 'Small monochrome OLED display with I2C interface.',
    productModelNumber: 'SSD1306',
    vendorPartNumber: '326',
    vendorName: 'Adafruit',
    quantity: 30,
    unitValue: 7.95,
    value: 238.50,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/326',
    category: 'LCDs & Displays',
    location: 'H2LD2B2',
    barcode: 'RIMS-0010',
    reorderPoint: 15,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // LEDs
  {
    name: 'NeoPixel Ring 16 RGB LED',
    description: 'Ring of 16 individually addressable RGB LEDs.',
    productModelNumber: 'WS2812B-16',
    vendorPartNumber: '1463',
    vendorName: 'Adafruit',
    quantity: 8,
    unitValue: 9.95,
    value: 79.60,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/1463',
    category: 'LEDs',
    location: 'H2LD3B1',
    barcode: 'RIMS-0011',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'LED Assortment Kit 5mm',
    description: '100 piece LED kit with red, green, yellow, blue, and white LEDs.',
    productModelNumber: 'LED-5MM-KIT',
    vendorPartNumber: 'COM-12062',
    vendorName: 'SparkFun',
    quantity: 5,
    unitValue: 8.95,
    value: 44.75,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/12062',
    category: 'LEDs',
    location: 'H2LD3B2',
    barcode: 'RIMS-0012',
    reorderPoint: 3,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Components & Parts
  {
    name: 'Resistor Kit 1/4W',
    description: '500 piece resistor assortment from 10 ohm to 1M ohm.',
    productModelNumber: 'RES-KIT-500',
    vendorPartNumber: 'COM-10969',
    vendorName: 'SparkFun',
    quantity: 3,
    unitValue: 12.95,
    value: 38.85,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/10969',
    category: 'Components & Parts',
    location: 'H3LD1B1',
    barcode: 'RIMS-0013',
    reorderPoint: 2,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Ceramic Capacitor Kit',
    description: '300 piece ceramic capacitor assortment, various values.',
    productModelNumber: 'CAP-KIT-300',
    vendorPartNumber: 'COM-13698',
    vendorName: 'SparkFun',
    quantity: 4,
    unitValue: 9.95,
    value: 39.80,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/13698',
    category: 'Components & Parts',
    location: 'H3LD1B2',
    barcode: 'RIMS-0014',
    reorderPoint: 2,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Electrolytic Capacitor Kit',
    description: '100 piece electrolytic capacitor assortment, 1uF to 1000uF.',
    productModelNumber: 'ECAP-KIT-100',
    vendorPartNumber: '2975',
    vendorName: 'Adafruit',
    quantity: 6,
    unitValue: 7.95,
    value: 47.70,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/2975',
    category: 'Components & Parts',
    location: 'H3LD1B3',
    barcode: 'RIMS-0015',
    reorderPoint: 3,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Power
  {
    name: '5V 2.5A Power Supply',
    description: 'USB-C power supply for Raspberry Pi 4, 5V 2.5A output.',
    productModelNumber: 'PS-5V-2.5A',
    vendorPartNumber: '4298',
    vendorName: 'Adafruit',
    quantity: 10,
    unitValue: 8.95,
    value: 89.50,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/4298',
    category: 'Power',
    location: 'H3LD2B1',
    barcode: 'RIMS-0016',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: '18650 Li-Ion Battery',
    description: 'Rechargeable 3.7V 2600mAh lithium-ion battery.',
    productModelNumber: '18650-2600',
    vendorPartNumber: '1781',
    vendorName: 'Adafruit',
    quantity: 20,
    unitValue: 9.95,
    value: 199.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/1781',
    category: 'Power',
    location: 'H3LD2B2',
    barcode: 'RIMS-0017',
    reorderPoint: 10,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'LM7805 Voltage Regulator',
    description: '5V 1A linear voltage regulator IC.',
    productModelNumber: 'LM7805',
    vendorPartNumber: '2164',
    vendorName: 'Adafruit',
    quantity: 50,
    unitValue: 0.75,
    value: 37.50,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/2164',
    category: 'Power',
    location: 'H3LD2B3',
    barcode: 'RIMS-0018',
    reorderPoint: 20,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Prototyping
  {
    name: 'Full-Size Breadboard',
    description: '830 tie-point solderless breadboard.',
    productModelNumber: 'BB-830',
    vendorPartNumber: '239',
    vendorName: 'Adafruit',
    quantity: 12,
    unitValue: 5.95,
    value: 71.40,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/239',
    category: 'Prototyping',
    location: 'H3LD3B1',
    barcode: 'RIMS-0019',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Jumper Wire Kit',
    description: '65 piece jumper wire kit for breadboarding.',
    productModelNumber: 'JW-65',
    vendorPartNumber: '153',
    vendorName: 'Adafruit',
    quantity: 8,
    unitValue: 6.95,
    value: 55.60,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/153',
    category: 'Prototyping',
    location: 'H3LD3B2',
    barcode: 'RIMS-0020',
    reorderPoint: 4,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Perfboard 5x7cm',
    description: 'Double-sided prototype PCB board, 5x7cm.',
    productModelNumber: 'PB-5x7',
    vendorPartNumber: '2670',
    vendorName: 'Adafruit',
    quantity: 25,
    unitValue: 1.50,
    value: 37.50,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/2670',
    category: 'Prototyping',
    location: 'H3LD3B3',
    barcode: 'RIMS-0021',
    reorderPoint: 10,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Wireless
  {
    name: 'ESP32 Development Board',
    description: 'WiFi and Bluetooth enabled microcontroller development board.',
    productModelNumber: 'ESP32-DEVKIT',
    vendorPartNumber: '3405',
    vendorName: 'Adafruit',
    quantity: 10,
    unitValue: 14.95,
    value: 149.50,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/3405',
    category: 'Wireless',
    location: 'H4LD1B1',
    barcode: 'RIMS-0022',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'nRF24L01+ Wireless Module',
    description: '2.4GHz wireless transceiver module.',
    productModelNumber: 'nRF24L01+',
    vendorPartNumber: 'WRL-00691',
    vendorName: 'SparkFun',
    quantity: 15,
    unitValue: 6.95,
    value: 104.25,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/691',
    category: 'Wireless',
    location: 'H4LD1B2',
    barcode: 'RIMS-0023',
    reorderPoint: 8,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Robotics
  {
    name: 'Servo Motor SG90',
    description: 'Micro servo motor, 180 degree rotation, 9g weight.',
    productModelNumber: 'SG90',
    vendorPartNumber: '169',
    vendorName: 'Adafruit',
    quantity: 20,
    unitValue: 5.95,
    value: 119.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/169',
    category: 'Robotics',
    location: 'H4LD2B1',
    barcode: 'RIMS-0024',
    reorderPoint: 10,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'DC Motor with Gearbox',
    description: '6V DC motor with 48:1 gearbox, 200 RPM.',
    productModelNumber: 'DCM-48',
    vendorPartNumber: '3777',
    vendorName: 'Adafruit',
    quantity: 8,
    unitValue: 3.50,
    value: 28.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/3777',
    category: 'Robotics',
    location: 'H4LD2B2',
    barcode: 'RIMS-0025',
    reorderPoint: 5,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'L298N Motor Driver',
    description: 'Dual H-bridge motor driver module for DC motors.',
    productModelNumber: 'L298N',
    vendorPartNumber: 'ROB-14450',
    vendorName: 'SparkFun',
    quantity: 6,
    unitValue: 12.95,
    value: 77.70,
    picture: null,
    vendorUrl: 'https://www.sparkfun.com/products/14450',
    category: 'Robotics',
    location: 'H4LD2B3',
    barcode: 'RIMS-0026',
    reorderPoint: 3,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Tools
  {
    name: 'Soldering Iron 60W',
    description: 'Temperature adjustable soldering iron with stand.',
    productModelNumber: 'SI-60W',
    vendorPartNumber: '180',
    vendorName: 'Adafruit',
    quantity: 3,
    unitValue: 22.00,
    value: 66.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/180',
    category: 'Tools',
    location: 'H5LD1B1',
    barcode: 'RIMS-0027',
    reorderPoint: 2,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Digital Multimeter',
    description: 'Auto-ranging digital multimeter with LCD display.',
    productModelNumber: 'DMM-AR',
    vendorPartNumber: '2034',
    vendorName: 'Adafruit',
    quantity: 4,
    unitValue: 17.50,
    value: 70.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/2034',
    category: 'Tools',
    location: 'H5LD1B2',
    barcode: 'RIMS-0028',
    reorderPoint: 2,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  // Cables
  {
    name: 'USB-C Cable 1m',
    description: 'USB-C to USB-A cable, 1 meter length.',
    productModelNumber: 'USB-C-1M',
    vendorPartNumber: '4474',
    vendorName: 'Adafruit',
    quantity: 15,
    unitValue: 4.95,
    value: 74.25,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/4474',
    category: 'Cables',
    location: 'H5LD2B1',
    barcode: 'RIMS-0029',
    reorderPoint: 8,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
  {
    name: 'Micro USB Cable 1m',
    description: 'Micro USB to USB-A cable, 1 meter length.',
    productModelNumber: 'MUSB-1M',
    vendorPartNumber: '592',
    vendorName: 'Adafruit',
    quantity: 20,
    unitValue: 2.95,
    value: 59.00,
    picture: null,
    vendorUrl: 'https://www.adafruit.com/product/592',
    category: 'Cables',
    location: 'H5LD2B2',
    barcode: 'RIMS-0030',
    reorderPoint: 10,
    createdAt: new Date().toISOString(),
    updatedAt: new Date().toISOString(),
  },
];

/**
 * Initialize the database and seed data if needed
 * This is now an async function that must be awaited
 */
export async function initializeData(): Promise<void> {
  // Initialize the SQLite database
  await initializeDatabase();

  // Check if we need to migrate from localStorage
  if (hasExistingLocalStorageData()) {
    console.log('Detected existing localStorage data, migrating to SQLite...');
    const result = migrateFromLocalStorage();
    console.log('Migration result:', result);

    // Verify migration
    const verification = verifyMigration();
    console.log('Migration verification:', verification);
    return;
  }

  // Check if database already has data
  const existingUsers = userRepository.count();
  if (existingUsers > 0) {
    console.log('Database already initialized with', existingUsers, 'users');
    return;
  }

  // Seed fresh data
  console.log('Seeding fresh database...');

  // Seed users
  for (const userData of seedUsers) {
    userRepository.create(userData);
  }

  // Seed items
  for (const itemData of seedItems) {
    itemRepository.create(itemData);
  }

  console.log('Database seeded successfully');
}

export { seedUsers, seedItems };
